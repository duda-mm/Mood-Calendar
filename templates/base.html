<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>The Notebook</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='clock.png') }}">
    
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --bg-mesa: #efebe4; 
            --bg-papel: #fdfbf7; 
            --text-main: #4A403A; 
            --text-muted: #8D7B68; 
            --accent: #C0A080; 
            --sidebar-width: 260px;
            --mood-muito-feliz: #F2CC8F;
            --mood-satisfeito: #D95D6A; 
            --mood-mediano: #CDC7BE; 
            --mood-ansioso: #FB9F78; 
            --mood-doente: #8875a6; 
            --mood-triste: #4b5b90; 
            --mood-vazio: #E9ECEF;
        }

        body { 
            background-color: var(--bg-mesa); 
            color: var(--text-main); 
            font-family: 'Nunito', sans-serif; 
            overflow-x: hidden; 
        }

        .page-transition { 
            animation: turnPage 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; 
            background: var(--bg-papel); 
            min-height: 95vh; 
            margin: 20px 20px 20px var(--sidebar-width); 
            border-radius: 20px; 
            box-shadow: -2px 0 15px rgba(0,0,0,0.02), 15px 15px 40px rgba(74, 64, 58, 0.1); 
            padding: 50px 60px; 
            position: relative;
            z-index: 1;
        }

        .full-center { 
            margin: 0 !important; 
            padding: 0 !important; 
            background: transparent !important; 
            box-shadow: none !important; 
            min-height: 100vh; 
        }

        @keyframes turnPage { 
            0% { opacity: 0; transform: translateY(20px); } 
            100% { opacity: 1; transform: translateY(0); } 
        }

        .sidebar { 
            width: var(--sidebar-width); 
            height: 100vh; 
            position: fixed; 
            padding: 40px 25px; 
            display: flex; 
            flex-direction: column; 
            z-index: 100; 
        }

        .brand { 
            font-family: 'Lora', serif; 
            font-size: 1.4rem; 
            font-weight: 700; 
            color: var(--text-main); 
            margin-bottom: 40px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }

        .nav-link { 
            color: var(--text-muted); 
            font-weight: 600; 
            padding: 12px 20px; 
            border-radius: 12px; 
            transition: 0.3s; 
            margin-bottom: 8px; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
        }

        .nav-link:hover { 
            background-color: rgba(255,255,255,0.6); 
            color: var(--text-main); 
            transform: translateX(5px); 
        }

        .nav-link.active { 
            background-color: white; 
            color: var(--accent); 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
        }

        .custom-card { 
            background: white; 
            border-radius: 16px; 
            padding: 25px; 
            border: 1px solid rgba(0,0,0,0.02); 
            box-shadow: 0 4px 20px rgba(0,0,0,0.03); 
        }

        .btn-custom { 
            background-color: var(--text-main); 
            color: white; 
            border-radius: 30px; 
            border: none; 
            font-weight: 600; 
        }

        textarea:focus { 
            box-shadow: 0 0 0 4px rgba(192, 160, 128, 0.15); 
            border-color: var(--accent); 
            outline: none; 
        }


        /* --------------------
            MOBILE AJUSTES
        ---------------------*/
        #mobile-menu-btn { display: none; }

        @media (max-width: 768px) {

            html, body { font-size: 17px; }

            .page-transition {
                margin: 0 !important;
                padding: 20px 18px !important;
                border-radius: 0;
                width: 100%;
                min-height: 100vh;
            }

            /* Sidebar vira drawer */
            .sidebar {
                transform: translateX(-100%);
                background: white;
                box-shadow: 5px 0 20px rgba(0,0,0,.15);
                transition: .3s;
            }

            .sidebar.open { transform: translateX(0); }

            /* Botão hambúrguer — só páginas autenticadas */
            body.auth #mobile-menu-btn {
                display: flex !important;
                position: fixed;
                top: 14px;
                left: 14px;
                z-index: 2000;
                align-items: center;
                justify-content: center;
            }

            /* Home pública → não aparece */
            body:not(.auth) #mobile-menu-btn { display:none !important; }

            .btn-custom { padding: 14px 18px !important; }

            input, textarea, select { padding: 14px !important; }

            .brand i { font-size: 1.6rem !important; }
        }
    </style>
</head>

<body class="{% if current_user.is_authenticated %}auth{% endif %}">

<!-- Botão hambúrguer (mobile only) -->
<button id="mobile-menu-btn" class="btn btn-custom">
    <i class="fas fa-bars"></i>
</button>


{% if current_user.is_authenticated and request.path not in ['/login','/cadastrar'] %}
<nav class="sidebar">

    <div class="brand">
        <i class="fas fa-clock fa-lg"></i> The Notebook
    </div>

    <div class="nav flex-column h-100">

        <small class="text-uppercase text-muted fw-bold mb-2 ms-3" style="font-size:.7rem;">Menu</small>

        <a href="/dashboard" class="nav-link"><i class="fas fa-home"></i> Início</a>
        <a href="/adicionar" class="nav-link"><i class="fas fa-pen-nib"></i> Escrever</a>

        <small class="text-uppercase text-muted fw-bold mb-2 ms-3 mt-4" style="font-size:.7rem;">Álbuns</small>

        <div style="max-height:40vh; overflow-y:auto;">
            {% if sidebar_tags %}
                {% for tag in sidebar_tags %}
                <a href="/dashboard?tag_id={{ tag.id }}" class="nav-link">
                    <i class="fas fa-bookmark" style="color:var(--accent);"></i> {{ tag.nome }}
                </a>
                {% endfor %}
            {% else %}
                <span class="ms-3 small text-muted fst-italic">Vazio...</span>
            {% endif %}
        </div>

        <div class="mt-auto">
            <hr class="text-muted opacity-25">
            <a href="/perfil" class="nav-link"><i class="fas fa-user-circle"></i> Perfil</a>
            <a href="/logout" class="nav-link"><i class="fas fa-sign-out-alt"></i> Sair</a>
        </div>

    </div>
</nav>
{% endif %}


<div class="page-transition {% if not current_user.is_authenticated or request.path in ['/login','/cadastrar'] %}full-center{% endif %}">

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div style="position: fixed; top:20px; right:20px; z-index:10000;">
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} shadow-lg rounded-4 mb-2">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
    {% endwith %}

    {% block conteudo %}{% endblock %}
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
const btn = document.getElementById("mobile-menu-btn");
const sidebar = document.querySelector(".sidebar");

if (btn && sidebar) {
    btn.addEventListener("click", () => {
        sidebar.classList.toggle("open");
    });
}
</script>

</body>
</html>
