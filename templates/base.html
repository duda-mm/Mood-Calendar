<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Notebook</title>

<link rel="icon" type="image/png" href="{{ url_for('static', filename='clock.png') }}">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
:root {
    --bg-mesa:#efebe4; --bg-papel:#fdfbf7;
    --text-main:#4A403A; --text-muted:#8D7B68;
    --accent:#C0A080; --sidebar-width:260px;
    --mood-muito-feliz:#F2CC8F; --mood-satisfeito:#D95D6A;
    --mood-mediano:#CDC7BE; --mood-ansioso:#FB9F78;
    --mood-doente:#8875a6; --mood-triste:#4b5b90;
}

body{background:var(--bg-mesa);color:var(--text-main);font-family:'Nunito',sans-serif;overflow-x:hidden}

/* PAGE TRANSITION */
.page-transition{
    animation:turnPage .8s cubic-bezier(.2,.8,.2,1) forwards;
    background:var(--bg-papel);
    min-height:95vh;
    margin:20px 20px 20px var(--sidebar-width);
    border-radius:20px;
    box-shadow:-2px 0 15px rgba(0,0,0,.02),15px 15px 40px rgba(74,64,58,.1);
    padding:50px 60px;
    position:relative;
    z-index:1;
}
@keyframes turnPage{from{opacity:0;transform:translateY(25px)}to{opacity:1;transform:translateY(0)}}

/* SIDEBAR */
.sidebar{
    width:var(--sidebar-width);height:100vh;position:fixed;
    padding:40px 25px;display:flex;flex-direction:column;z-index:100;
    transition:.35s ease-in-out;
}
.brand{
    font-family:'Lora',serif;font-size:1.4rem;font-weight:700;
    color:var(--text-main);margin-bottom:40px;display:flex;align-items:center;gap:10px;
}

/* NAV */
.nav-link{
    color:var(--text-muted);font-weight:600;padding:12px 20px;border-radius:12px;
    margin-bottom:8px;display:flex;gap:12px;align-items:center;transition:.25s;
}
.nav-link:hover{background:rgba(255,255,255,.6);color:var(--text-main);transform:translateX(6px)}
.nav-link.active{background:#fff;color:var(--accent);box-shadow:0 4px 15px rgba(0,0,0,.05)}

/* CARDS */
.custom-card{background:#fff;border-radius:16px;padding:25px;border:1px solid rgba(0,0,0,.05);box-shadow:0 4px 20px rgba(0,0,0,.04);transition:.3s}
.custom-card:hover{transform:translateY(-3px) scale(1.01);box-shadow:0 10px 28px rgba(0,0,0,.12)}

/* BUTTONS */
.btn-custom{background:var(--text-main);color:#fff;border-radius:30px;font-weight:600;border:none;transition:.25s;position:relative;overflow:hidden}
.btn-custom:hover{background:var(--accent);transform:translateY(-2px)}

/* RIPPLE */
.ripple{position:absolute;border-radius:50%;background:rgba(255,255,255,.45);transform:scale(0);animation:ripple-anim .6s linear}
@keyframes ripple-anim{to{transform:scale(4);opacity:0}}

/* FIRE ANIMATION */
.animate-pulse{animation:pulse 2s infinite}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.12)}100%{transform:scale(1)}}

/* ZEN MODE */
body.zen-mode .sidebar,
body.zen-mode .blur-target{filter:blur(6px);opacity:.35;transition:.4s}
textarea:focus{box-shadow:0 0 0 4px rgba(192,160,128,.15);border-color:var(--accent)}

/* HAMBURGER default */
#mobile-menu-btn{display:none}

/* ------------------ MOBILE ------------------ */
@media(max-width:768px){

    html,body{font-size:17px}

    .page-transition{margin:0!important;padding:20px 18px!important;border-radius:0;width:100%}

    .sidebar{transform:translateX(-100%);background:#fff;box-shadow:6px 0 24px rgba(0,0,0,.18)}
    .sidebar.open{transform:translateX(0)}

    /* Button visible only logged in */
    body.auth #mobile-menu-btn{
        display:flex!important;position:fixed;top:14px;left:14px;z-index:2000;
        align-items:center;justify-content:center;padding:12px 14px;gap:10px;
    }
    body:not(.auth) #mobile-menu-btn{display:none!important}

    /* üëâ LOGO EM UMA LINHA ABAIXO DO BOT√ÉO */
    .brand{
        margin-left:0;
        margin-top:58px;   /* dist√¢ncia abaixo do hamb√∫rguer */
        gap:10px;
        white-space:nowrap; /* evita quebra em duas linhas */
        align-items:center;
    }

    .btn-custom{padding:14px 18px!important}
    input,textarea,select{padding:14px!important}
    .brand i{font-size:1.6rem!important}
}
</style>
</head>

<body class="{% if current_user.is_authenticated %}auth{% endif %}">

<button id="mobile-menu-btn" class="btn btn-custom">
  <i class="fas fa-bars"></i>
</button>

{% if current_user.is_authenticated and request.path not in ['/login','/cadastrar'] %}
<nav class="sidebar">
    <div class="brand">
        <i class="fas fa-clock fa-lg"></i> The Notebook
    </div>

    <div class="nav flex-column h-100">
        <small class="text-uppercase text-muted fw-bold mb-2 ms-3" style="font-size:.7rem;">Menu</small>

        <a href="/dashboard" class="nav-link"><i class="fas fa-home"></i> In√≠cio</a>
        <a href="/adicionar" class="nav-link"><i class="fas fa-pen-nib"></i> Escrever</a>

        <small class="text-uppercase text-muted fw-bold mb-2 ms-3 mt-4" style="font-size:.7rem;">√Ålbuns</small>

        <div style="max-height:40vh; overflow-y:auto;">
            {% if sidebar_tags %}
                {% for tag in sidebar_tags %}
                <a href="/dashboard?tag_id={{ tag.id }}" class="nav-link">
                    <i class="fas fa-bookmark" style="color:var(--accent);"></i> {{ tag.nome }}
                </a>
                {% endfor %}
            {% else %}
                <span class="ms-3 small text-muted fst-italic">Vazio...</span>
            {% endif %}
        </div>

        <div class="mt-auto">
            <hr class="text-muted opacity-25">
            <a href="/perfil" class="nav-link"><i class="fas fa-user-circle"></i> Perfil</a>
            <a href="/logout" class="nav-link"><i class="fas fa-sign-out-alt"></i> Sair</a>
        </div>
    </div>
</nav>
{% endif %}

<div class="page-transition {% if not current_user.is_authenticated or request.path in ['/login','/cadastrar'] %}full-center{% endif %}">
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div style="position:fixed; top:20px; right:20px; z-index:10000;">
{% for category,message in messages %}
<div class="alert alert-{{ category }} shadow-lg rounded-4 mb-2">{{ message }}</div>
{% endfor %}
</div>
{% endif %}
{% endwith %}
{% block conteudo %}{% endblock %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ripple */
document.addEventListener("click",e=>{
 const t=e.target.closest(".btn-custom,.nav-link");
 if(!t)return;
 const c=document.createElement("span");
 const d=Math.max(t.clientWidth,t.clientHeight),r=d/2,rect=t.getBoundingClientRect();
 c.className="ripple";
 c.style.width=c.style.height=`${d}px`;
 c.style.left=`${e.clientX-rect.left-r}px`;
 c.style.top =`${e.clientY-rect.top-r}px`;
 t.querySelector(".ripple")?.remove();
 t.appendChild(c);
});

/* zen mode */
document.querySelectorAll("textarea").forEach(t=>{
 t.addEventListener("focus",()=>document.body.classList.add("zen-mode"));
 t.addEventListener("blur" ,()=>document.body.classList.remove("zen-mode"));
});

/* drawer toggle */
const btn=document.getElementById("mobile-menu-btn");
const sidebar=document.querySelector(".sidebar");
if(btn && sidebar){ btn.addEventListener("click",()=>sidebar.classList.toggle("open")); }
</script>
</body>
</html>
